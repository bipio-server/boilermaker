// (c) WoT.IO inc (2014)
// ### About
//        BipIO Pod Manifest Definition v0.1 (draft)
// The `bpm.json` file describes how to assemble a Pod boilerplate programatically
// and is an authoritative schema from which different views can be surfaced.

// ### General Config
// Defines general information about this Pod
{
  // __Name__ (_string_) alphanumeric, lowercase object key (unique key)
  "name" : "pod_name",

  // __Title__ (_string_) is the short, human readable version of `name`
  "title" : "Pod Name",

  // __Useful Description__ (_string_) is the description used when generating UI and supporting documentation
  "description" : "For doing X-Y-Z",

  // __Provider URL__ (_string_, optional) URL to service provider
  "url" : "Provider URL",

  // __Track Duplicates__ (_boolean_, optional default `false`) Pod requires a de-duplication resource
  "trackDuplicates" : true,

  // __Data Sources__ (_object_, optional) Model objects which should be bound to a DAO resource,
  // keyed by the name of the action.
  "dataSources" : {
    // __Model__ (_object_) Model Object, keyed by the name of the model.
    "my_model" : {
      // Expects <a href="http://json-schema.org/">JSON Schema</a>
      "properties" : {
        "id" : {
          "type" : "string"
        }
      },
      // __Keys__  (_array_) Unique Key (all keys in array create a compound key
      "keys" : [ "id" ]
    }
  },

  // __Config__ (_object_) anything here is persisted to server config (`default.json`) when the pod is installed
  "config" : {
    "example_stored_key" : "value",

    // __OAuth Config__ (_object_) if your pod uses oAuth, store the <a href="http://passportjs.org/">node-passport</a> strategy configs here.
    "oauth" : {
      "clientID" : "oauth client id",
      "clientSecret" : "oauth client secret"
    }
  },

  // ### Authentication
  // The Authentication block describes how users should authenticate setup of their channels, and
  // what credentials to use when channels are invoked

  // __Auth Strategy__ (_object_, optional) user authentication strategy
  "auth" : {

    // __Strategy__ (_string_) one of :
    // * `none` (default) no authentication required
    // * `oauth` User must negotiate oAuth credentials
    // * `issuer_token` User must supply authentication tokens
    "strategy" : "oauth",

    // __Passport__ (_object_, optional) when `strategy : oauth`, sets <a href="http://passportjs.org/">node-passport</a>
    // strategy instantiation parameters
    "passport" : {
      // __Provider__ (_string_, optional, default pod name) strategy name
      "provider" : "google",
      // __Function__ (_string_, optional, default 'Strategy') strategy function name
      "function" : "Strategy",
    },

    //supply the name of the <a href="http://passportjs.org/">node-passport</a> strategy name here

    // __Auth Map__ (_object_, optional) when `strategy : issuer_token`, `authMap` maps internal attributes to how it is described by the pod provider.
    // For example, HipChat needs an access token, so `authMap` contains `password : 'API Access Token'`.
    // __Note__ Its up to pods to implement this mapping
    "authMap" : {
      "username" : "User Name Label",
      "password" : "API Key",
      "key" : "Private Key"
    }
  },

  // ### Remote Procedure Calls

  // __RPC's__ (_object_, optional) <a target="_blank" href="http://en.wikipedia.org/wiki/Remote_procedure_call">RPC's</a> implemented by this _Pod_
  "rpcs" : {
    // __Key__ (_object_) Renderer key, becomes the URI eg:  `/rpc/pod/:pod_name/:rpc_name`
    "rpc_name" : {
      // __Title__ (_string_) Short, human readable RPC label
      "title" : "Do Something",
      // __Description__ (_string_) extended description
      "description" : "This is what it does",
      // __Content Type__ (_string_) expected response mime type
      "contentType" : "application/json"
    }
  },

  // ### Actions
  // Actions are individual methods supplied by the provider API.  When a channel is created,
  // it points to `pod_name.action_name`

  // __Actions__ (_object_) Implemented Action Schemas
  "actions" : {
      // __Action Key__ (_object_) Action Schema, keyed by the name of the action.
      // action implementation will be written to `./{action_name}.js` for this pod
      "action_name" : {
        // __Title__ (_string_) Short, human readable action name
        "title" : "Action Name",

        // __Description__ (_string_) extended description
        "description":"Action Name does some great thing",

        // __Reference Documentation__ (_string_) Provider Reference Documentation URL.
        // should point to the authoritative documentation this action attempts to encapsulate.
        "provider_ref" : "http://example.org/docs/#action_name",

        // __Trigger__ (_string_, optional) one of :
        // * `invoke` - (default) must be explicitly invoked
        // * `poll` - should be periodically polled with system scheduler
        // * `realtime` - self managed
        "trigger" : "invoke",

        // #### Configuration
        // config items make immutable attributes available, or provide sane defaults
        // in the case of an import not existing

        // __Config__ (_object_, optional) Channel Configuration Schema - channel defaults.
        // Expects <a href="http://json-schema.org/">JSON Schema</a>
        "config" : {
            // __Properties__ (_object_, optional) JSON-Schema Properties Object
            "properties": {
              // __Name__ (_object_) Property, keyed by name
              "rcpt_to" : {
                // __Type__ (_string_) Property type
                "type" : "string",
                // __Title__ (_string_) Short, human readable action label
                "title" : "Email Address",
                // __Description__ (_string_) extended description
                "description" : "(eg : foo@bar.com)",
                // __Default__ (_mixed_) default value
                "default" : "Some Sane Default"
              }
            },
            // __Required Fields__ (_array_, optional) list of required property `name`
            "required": [
              "rcpt_to"
           ],
           // __Disposition__ (_array_) ordered list of property names, where required fields
           // are first, then optional properties, then most optional properties
           "disposition" : [
            "rcpt_to"
           ]
        },

        // #### Imports
        // Imports define the data structure this action _expects_

        // __Imports__ (_object_, optional) Data Imports Schema.
        // Expects <a href="http://json-schema.org/">JSON Schema</a>
        "imports" : {
            // __Properties__ (_object_, optional) JSON-Schema Properties Object
            "properties": {
              // __Name__ (_object_) Property, keyed by name
              "message_id" : {
                // __Type__ (_string_) Property type
                "type" : "string",
                // __Title__ (_string_) Short, human readable action label
                "title" : "Message ID",
                // __Description__ (_string_) extended description
                "description" : "abc-123",
              }
            },
            // __Required Fields__ (_array_, optional) list of required property `name`
            "required": [
              "rcpt_to"
           ],
           // __Disposition__ (_array_) ordered list of property names, where required fields
           // are first, then optional properties, then most optional properties.
           "disposition" : [
            "rcpt_to"
           ]
        },

        // #### Exports
        // Exports define the data structure this action _produces_

        // __Exports__ (_object_, optional) Data Exports Schema.
        // Expects <a href="http://json-schema.org/">JSON Schema</a>
        "exports" : {
          // __Properties__ (_object_, optional) JSON-Schema Properties Object
          "properties": {
            // __Name__ (_object_) Property, keyed by name
            "message_id" : {
              // __Type__ (_string_) Property type
              "type" : "string",

              // __Title__ (_string_) Short, human readable action label
              "title" : "Message ID",
              // __Description__ (_string_) extended description
              "description" : "abc-123"
            }
          }
        },

        // #### Remote Procedure Calls

        // __RPC's__ (_object_, optional) <a target="_blank" href="http://en.wikipedia.org/wiki/Remote_procedure_call">RPC's</a> implemented by this _Action_
        "rpcs" : {
          // __Key__ (_object_) Renderer key, becomes the URI eg: `/rpc/channel/:channel_id/:action_rpc_name`
          "action_rpc_name" : {
            // __Title__ (_string_) Short, human readable RPC label
            "title" : "Do Something",
            // __Description__ (_string_) extended description
            "description" : "This is what it does",
            // __Content Type__ (_string_) expected response mime type
            "contentType" : "application/json"
          }
        }
     }
  }
}